import { Match as M } from 'effect'
import { Html } from 'foldkit/html'

import { Class, div } from '../../html'
import type { Message as ParentMessage } from '../../message'
import { notFoundView } from '../../notFoundView'
import { homeRouter } from '../../route'
import { GotLoginMessage, Message } from './message'
import { Model } from './model'
import * as Home from './page/home'
import * as Login from './page/login'

export const view = (
  model: Model,
  toMessage: (message: Message) => ParentMessage,
): Html =>
  div(
    [Class('py-8')],
    [
      M.value(model.route).pipe(
        M.tagsExhaustive({
          Home: () => Home.view(),
          Login: () =>
            Login.view(model.loginModel, (message) =>
              toMessage(GotLoginMessage.make({ message })),
            ),
          NotFound: ({ path }) =>
            notFoundView(path, homeRouter.build({}), 'Go Home'),
        }),
      ),
    ],
  )
